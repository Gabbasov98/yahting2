

$("._toggle-menu").click(function () {
    $(".header").toggleClass("_open")
    $("body").toggleClass("fixed-body")
})

$("._toggle-lang").click(function () {
    $(this).parents(".lang-select").toggleClass("_active")
})

$(document).mouseup( function(e){
    var div = $( ".lang-select" );
    if ( !div.is(e.target)
        && div.has(e.target).length === 0 ) {
        if($(div).hasClass("_active")){
            $(div).removeClass("_active")
        }
    }
});

function Sliders() {
    let SlidersArray = []

    let sliders = document.querySelectorAll(".slider")
    sliders.forEach((slider,index) => {
        let isLoop = slider.classList.contains("_loop")
        slider.setAttribute("data-slider-id",index)

        SlidersArray[index] = new Swiper(`.slider[data-slider-id="${index}"] .swiper-container`, {
            slidesPerView: "auto",
            spaceBetween: 0,
            watchSlidesProgress: true,
            preventClicks :true,
            a11y: false,
            observer: true,
            observeParents: true,
            observeSlideChildren: true,
            loop: isLoop,
            navigation: {
                nextEl: `.slider[data-slider-id="${index}"] .swiper-button-next`,
                prevEl: `.slider[data-slider-id="${index}"] .swiper-button-prev`,
            },
            pagination: {
                el: `.slider[data-slider-id="${index}"] .swiper-pagination`,
                type: 'bullets',
                clickable: true,
            },
        })
    })
}

function gallery() {
    let SlidersArray = []

    let sliders = document.querySelectorAll(".slider2")
    sliders.forEach((slider,index) => {
        slider.setAttribute("data-slider-id",index)

        SlidersArray[index] = new Swiper(`.slider2[data-slider-id="${index}"] .swiper-container`, {
            slidesPerView: 1,
            spaceBetween: 0,
            navigation: {
                nextEl: `.slider2[data-slider-id="${index}"] .swiper-button-next`,
                prevEl: `.slider2[data-slider-id="${index}"] .swiper-button-prev`,
            },
            pagination: {
                el: `.slider2[data-slider-id="${index}"] .swiper-pagination`,
                type: 'fraction',
            },
        })
    })

}


Sliders()


$(".roadmap-card__btn").click(function () {
    $(".roadmap-item").removeClass("_active")
    $(this).parents(".roadmap-item").addClass("_active")
    $(".roadmap__grid").addClass("_open")
})

$(".roadmap-detail__btn").click(function () {
    $(".roadmap-item").removeClass("_active")
    $(".roadmap__grid").removeClass("_open")
})

$(".reviews").each(function (i,el) {
    reviews($(el))
})

function reviews(reviews) {
    let current = 0
    let cardsCount = $(reviews).find(".review-card").length

    $(reviews).find("._more-reviews").click(function () {
        current += getCurrentCount()
        if(current + getCurrentCount() >= cardsCount){
            $(this).addClass("_hide")
            $(reviews).find("._hide-reviews").removeClass("_hide")
        }
        for (let i = current + 1; i<current+9;i++){
            let card = $(reviews).find(`.review-card:nth-child(${i})`)
            $(card).addClass("_active")
        }
    })

    $("._hide-reviews").click(function () {
        $(this).addClass("_hide")
        $(reviews).find("._more-reviews").removeClass("_hide")
        $(reviews).find(".review-card").removeClass("_active")
    })
}


function getCurrentCount(){
    if(window.innerWidth>992){
        return 8
    }
    if(window.innerWidth<993 && window.innerWidth > 576){
        return 6
    }

    return 4
}

// function storiesSlider() {
//     let autoplayDelay = 10000
//     let autoplayProps = {
//         delay: autoplayDelay,
//         disableOnInteraction: false,
//     }
//     let storiesDelay = 5000
//
//     let swiper = new Swiper('.stories-slider .swiper-container', {
//         slidesPerView: 1,
//         spaceBetween: 0,
//         effect: "cube",
//         allowTouchMove: false,
//         autoplay: autoplayProps,
//         navigation: {
//             nextEl: '.stories-slider .swiper-button-next',
//             prevEl: '.stories-slider .swiper-button-prev',
//         },
//         pagination: {
//             el: '.stories-slider .swiper-pagination',
//             type: 'bullets',
//             clickable: true,
//             renderBullet: function(index, className) {
//                 return `
//                     <div class="swiper-pagination-bullet ${className}"><span></span></div>
//                 `;
//             },
//         },
//         init: false,
//     })
//
//     swiper.on('slideChangeTransitionEnd', function() {
//         let currentSlider = swiper.slides[swiper.activeIndex]
//         let slidesCount = swiper.slides.length
//         swiper.autoplay = autoplayProps
//
//
//         $(".stories-slider .swiper-pagination-bullet-active span").css(
//             "animation-duration", `${autoplayDelay / 1000}s`
//         )
//
//         if(currentSlider.classList.contains("_video")){
//             let video = currentSlider.querySelector('.story-card__video');
//             swiper.autoplay = false
//             console.log(video.duration * 1000)
//
//             video.addEventListener('click',function(){
//                 video.play();
//             },false);
//             video.click();
//             video.play();
//
//
//             setTimeout(()=>{
//                 // video.muted = false
//             },100)
//
//             video.addEventListener('ended',function(){
//                 // alert('конец видео')
//                 if(swiper.activeIndex + 1 < slidesCount){
//                     swiper.slideTo(swiper.activeIndex + 1)
//                     swiper.autoplay = autoplayProps
//                     video.currentTime = 0;
//                 }
//             })
//         }
//     });
//
//     $("._show-stories").click(function () {
//         $(".stories-modal").addClass("_open")
//         $("body").addClass("fixed-body")
//         swiper.init()
//         $(".stories-slider .swiper-pagination-bullet-active span").css(
//             "animation-play-state", "running"
//         )
//     })
//
//     $("._hide-stories").click(function () {
//         $(".stories-modal").removeClass("_open")
//         $("body").removeClass("fixed-body")
//     })
// }
//
// storiesSlider()


//set video duration
const videos = document.querySelectorAll('.story__slide video');
videos.forEach(video => {
    video.onloadedmetadata = function() {
        console.log('metadata loaded!');
        console.log(this.duration);//this refers to myVideo
        $(video).parents('.story__slide').attr('data-swiper-autoplay', this.duration * 1000);
    };
    // console.log(video.duration)

});

const slider = new Swiper(".story__slider", {
    init: false,
    speed: 1,
    watchSlidesProgress: true,
    loop: true,
    autoplay: {
        delay: 15000,
        disableOnInteraction: false
    },
    slidesPerView: 1,
    navigation: {
        nextEl: ".story__next",
        prevEl: ".story__prev",
    },
    pagination: {
        el: '.story__pagination',
        renderBullet: function (index, className) {
            return '<div class="' + className + '"> <div class="swiper-pagination-progress"></div> </div>';
        }
    },
    on: {
        autoplayTimeLeft(swiper, time, progress) {
            let currentSlide = document.querySelectorAll('.story__slider .swiper-slide')[swiper.activeIndex]
            let currentBullet = document.querySelectorAll('.story__slider .swiper-pagination-progress')[swiper.realIndex]
            let fullTime = currentSlide.dataset.swiperAutoplay ? parseInt(currentSlide.dataset.swiperAutoplay) : swiper.params.autoplay.delay;

            let percentage = Math.min( Math.max ( parseFloat(((fullTime - time) * 100 / fullTime).toFixed(1)), 0), 100) + '%';
            console.log(percentage)
            gsap.set(currentBullet, {width: percentage});
        },
        transitionEnd(swiper) {
            let allBullets = $('.story__slider .swiper-pagination-progress');
            let bulletsBefore = allBullets.slice(0, swiper.realIndex);
            let bulletsAfter = allBullets.slice(swiper.realIndex, allBullets.length);
            if(bulletsBefore.length) {gsap.set(bulletsBefore, {width: '100%'})}
            if(bulletsAfter.length) {gsap.set(bulletsAfter, {width: '0%'})}

            let activeSlide = document.querySelectorAll('.story__slider .swiper-slide')[swiper.realIndex];
            if (activeSlide.querySelector('video')) {
                activeSlide.querySelector('video').currentTime = 0;
            }
        },
    }
});
    $("._show-stories").click(function () {
        $(".stories-modal").addClass("_open")
        $("body").addClass("fixed-body")
        slider.init()
        $(".stories-slider .swiper-pagination-bullet-active span").css(
            "animation-play-state", "running"
        )
    })

    $("._hide-stories").click(function () {
        $(".stories-modal").removeClass("_open")
        $("body").removeClass("fixed-body")
    })

let fileInput = document.querySelector("[data-upload-id='file-input']")

if(fileInput){
    console.log(fileInput)
    const upload = new FileUploadWithPreview.FileUploadWithPreview('file-input');

    upload.options.multiple = true

    $(document).on('change', '.input-container input', function(e) {
        $(this).parents(".file-input").addClass("_uploaded")
    })

    $(document).on('click', '.image-preview-item-clear', function(e) {
        let count = $(this).parents(".file-input").find(".image-preview-item").length
        if(count === 1){
            $(this).parents(".file-input").removeClass("_uploaded")
        }
    })
}






window.addEventListener('DOMContentLoaded', () => {
    fix100vh();
    window.addEventListener('resize', () => {
        fix100vh();
        getScrollBarSize()
    })

    getScrollBarSize()

    $(".course-card__show").click(function () {
        $(this).parents(".course-card").toggleClass("_active")
        $(this).siblings(".course-card__hidden").slideToggle()
    })

    $(".qa-card__show").click(function () {
        $(this).parents(".qa-card").toggleClass("_active")
        $(this).siblings(".qa-card__hidden").slideToggle()
    })

    $("._show-success").click(function () {
        $(".buy").addClass("_success")
    })

    gallery()

    let body = document.querySelector("body")
    let modalTogglers = document.querySelectorAll("[data-modal]")
    let modals = document.querySelectorAll(".modal")

    modalTogglers.forEach(el => {
        el.onclick = function () {
            let modalId = el.getAttribute("data-modal")
            openModal(modalId)

            if(el.classList.contains("_from-gallery-modal")){
                $(`#${modalId}`).addClass("_back-to-gallery")
            }
        }
    })

    function closeModals() {
        modals.forEach(modal => {
            modal.classList.remove("_active")
            body.classList.remove("fixed-body2")
        })
        $(".buy").removeClass("_success")
    }

    function openModal(modalId) {
        closeModals()
        let modal = document.querySelector(`#${modalId}`)
        let closeButtons = modal.querySelectorAll(`._close-modal`)

        modal.classList.add("_active")
        body.classList.add("fixed-body2")


        closeButtons.forEach(btn => {
            btn.onclick = ()=> {
                modal.classList.remove("_active")
                body.classList.remove("fixed-body2")
                if(modal.classList.contains("_back-to-gallery")){
                    modal.classList.remove("_back-to-gallery")
                    openModal("galleryModal")
                }
            }
        })
    }


})

function fix100vh() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}


$(window).on('load resize', function(){
    if ($(window).width() <= 992) {
        $('.contest-advantages').insertAfter('.contest2__grid');
    } else{
        $('.contest-advantages').insertAfter('.contest2__text2');
    }
});

var getScrollBarSize = (function() {
    var el = window.document.createElement('textarea'), style = {
        'visibility': 'hidden', 'position': 'absolute', 'zIndex': '-2147483647',
        'top': '-1000px', 'left': '-1000px', 'width': '1000px', 'height': '1000px',
        'overflow': 'scroll', 'margin': '0', 'border': '0', 'padding': '0'
    }, support = el.clientWidth !== undefined && el.offsetWidth !== undefined;

    for (var key in style) {
        if (style.hasOwnProperty(key)) {
            el.style[key] = style[key];
        }
    }

    return function() {
        var size = null;
        if (support && window.document.body) {
            window.document.body.appendChild(el);
            size = [el.offsetWidth - el.clientWidth, el.offsetHeight - el.clientHeight];
            window.document.body.removeChild(el);
        }

        document.documentElement.style.setProperty('--scrollWidth', `${size[0]}px`);
        return size;
    };
})();

//# sourceMappingURL=../sourcemaps/main.min.js.map
